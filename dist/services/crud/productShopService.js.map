{"version":3,"sources":["../../../build/services/crud/productShopService.js"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","crudService_pg_1","require","tables_1","models_1","ProductShopService","ProductShop","body","item_id","state","type","sequelize","transaction","shop","exec","Shop","findOne","where","id","update","not_in_use","model","shop_id","findAndCount","list_product_shops","array_ids","count","i","rows","length","item","push","product_id","Product","$in","product","commit","rollback","CrudService"],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,IAAIA,mCAAa,kEAAQ,UAAKA,SAAb,CAAD,8BAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AAAA;AAAA;;AACrF,WAAO,KAAK,0DAAMD,IAAIE,OAAV,CAAL,EAAyB,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAAA;;AACvD,iBAASC,SAAT,CAAmBC,KAAnB,EAA0B;AAAA;AAAA;AAAE,gBAAI;AAAA;AAAEC,qBAAKN,UAAUO,IAAV,CAAeF,KAAf,CAAL;AAA8B,aAApC,CAAqC,OAAOG,CAAP,EAAU;AAAA;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC3F,iBAASC,QAAT,CAAkBJ,KAAlB,EAAyB;AAAA;AAAA;AAAE,gBAAI;AAAA;AAAEC,qBAAKN,UAAU,OAAV,EAAmBK,KAAnB,CAAL;AAAkC,aAAxC,CAAyC,OAAOG,CAAP,EAAU;AAAA;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC9F,iBAASF,IAAT,CAAcI,MAAd,EAAsB;AAAA;AAAA;AAAEA,mBAAOC,IAAP,6BAAcT,QAAQQ,OAAOL,KAAf,CAAd,8BAAsC,IAAIN,CAAJ,CAAM,UAAUG,OAAV,EAAmB;AAAA;AAAA;AAAEA,wBAAQQ,OAAOL,KAAf;AAAwB,aAAnD,EAAqDO,IAArD,CAA0DR,SAA1D,EAAqEK,QAArE,CAAtC;AAAuH;AAHxF;AAIvDH,aAAK,CAACN,YAAYA,UAAUa,KAAV,CAAgBhB,OAAhB,EAAyB,mEAAc,EAAd,CAAzB,CAAb,EAAyDU,IAAzD,EAAL;AACH,KALM,CAAP;AAMH,CAPe,CAAZ,CAAJ;;AAQAO,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C,EAAEX,OAAO,IAAT,EAA7C;AACA,IAAMY,2CAAmBC,QAAQ,mBAAR,CAAnB,CAAN;AACA,IAAMC,mCAAWD,QAAQ,qBAAR,CAAX,CAAN;AACA,IAAME,mCAAWF,QAAQ,cAAR,CAAX,CAAN;;IACMG,kB;;;AACF,kCAAc;AAAA;AAAA;AAAA;AAAA,qJACJF,SAASG,WADL;AAEb;;;;0CACiBC,I,EAAM;AAAA;AAAA;;AACpB,mBAAO3B,UAAU,IAAV,EAAgB,KAAK,CAArB,EAAwB,KAAK,CAA7B,0CAAgC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gEACF2B,IADE,GAC3BC,OAD2B,SAC3BA,OAD2B,EAClBC,KADkB,SAClBA,KADkB,EACXC,IADW,SACXA,IADW;AAAA;AAAA;AAAA,uCAETN,SAASO,SAAT,CAAmBC,WAAnB,EAFS;;AAAA;AAE7BA,2CAF6B;AAAA;AAAA;AAAA;;AAAA,sCAI3BF,SAAS,MAJkB;AAAA;AAAA;AAAA;;AAAA;AAKrBG,oCALqB,2BAKd,KAAKC,IAAL,CAAUX,SAASY,IAAT,CAAcC,OAAd,CAAsB;AACzCC,2CAAO;AACHC,4CAAIV;AADD;AADkC,iCAAtB,CAAV,CALc;AAAA;;AAAA,qCAUvBK,IAVuB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,uCAWjB,KAAKC,IAAL,CAAUX,SAASY,IAAT,CAAcI,MAAd,CAAqB,EAAEC,YAAYX,KAAd,EAArB,EAA4C;AACxDQ,2CAAO;AACHC,4CAAIV;AADD,qCADiD;AAIxDI;AAJwD,iCAA5C,CAAV,CAXiB;;AAAA;AAAA;AAAA;AAAA,uCAiBjB,KAAKE,IAAL,CAAU,KAAKO,KAAL,CAAWF,MAAX,CAAkB,EAAEC,YAAYX,KAAd,EAAlB,EAAyC;AACrDQ,2CAAO;AACHK,iDAASd;AADN,qCAD8C;AAIrDI;AAJqD,iCAAzC,CAAV,CAjBiB;;AAAA;AAAA;AAAA;AAAA,uCAuBU,KAAKE,IAAL,CAAU,KAAKO,KAAL,CAAWE,YAAX,CAAwB;AAC/DN,2CAAO;AACHK,iDAASd;AADN;AADwD,iCAAxB,CAAV,CAvBV;;AAAA;AAuBjBgB,kDAvBiB;AA4BnBC,yCA5BmB,2BA4BP,EA5BO;AAAA;;AA6BvB,oCAAID,mBAAmBE,KAAnB,GAA2B,CAA/B,EAAkC;AAAA;AAAA;;AAC9B,yCAASC,CAAT,GAAa,CAAb,EAAgBA,IAAIH,mBAAmBI,IAAnB,CAAwBC,MAA5C,EAAoDF,GAApD,EAAyD;AAC/CG,4CAD+C,2BACxCN,mBAAmBI,IAAnB,CAAwBD,CAAxB,CADwC;AAAA;;AAErDF,kDAAUM,IAAV,CAAeD,KAAKE,UAApB;AACH;AACJ,iCALD;AAAA;AAAA;AA7BuB;;AAAA,sCAmCnBP,UAAUI,MAAV,GAAmB,CAnCA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,uCAoCb,KAAKf,IAAL,CAAUX,SAAS8B,OAAT,CAAiBd,MAAjB,CAAwB;AACpCC,gDAAYX;AADwB,iCAAxB,EAEb;AACCQ,2CAAO;AACHC,4CAAI,EAAEgB,KAAKT,SAAP;AADD;AADR,iCAFa,CAAV,CApCa;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA,sCA8CtBf,SAAS,SA9Ca;AAAA;AAAA;AAAA;;AAAA;AA+CrByB,uCA/CqB,2BA+CX,KAAKrB,IAAL,CAAUX,SAAS8B,OAAT,CAAiBjB,OAAjB,CAAyB;AAC/CC,2CAAO;AACHC,4CAAIV;AADD;AADwC,iCAAzB,CAAV,CA/CW;AAAA;;AAAA,qCAoDvB2B,OApDuB;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA,uCAqDjB,KAAKrB,IAAL,CAAUX,SAAS8B,OAAT,CAAiBd,MAAjB,CAAwB,EAAEC,YAAYX,KAAd,EAAxB,EAA+C;AAC3DQ,2CAAO;AACHC,4CAAIV;AADD,qCADoD;AAI3DI;AAJ2D,iCAA/C,CAAV,CArDiB;;AAAA;AAAA;AAAA;AAAA,uCA2DjB,KAAKE,IAAL,CAAU,KAAKO,KAAL,CAAWF,MAAX,CAAkB,EAAEC,YAAYX,KAAd,EAAlB,EAAyC;AACrDQ,2CAAO;AACHe,oDAAYxB;AADT,qCAD8C;AAIrDI;AAJqD,iCAAzC,CAAV,CA3DiB;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAmE/BA,4CAAYwB,MAAZ;AAnE+B;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAuE/BxB,4CAAYyB,QAAZ;AAvE+B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAAhC,EAAP;AA2EH;;;GAhF4BpC,iBAAiBqC,W;;;;AAkFlDtC,QAAQK,kBAAR,GAA6BA,kBAA7B;AACA","file":"productShopService.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst crudService_pg_1 = require(\"../crudService.pg\");\nconst tables_1 = require(\"@/models/tables\");\nconst models_1 = require(\"@/models\");\nclass ProductShopService extends crudService_pg_1.CrudService {\n    constructor() {\n        super(tables_1.ProductShop);\n    }\n    changeAllNotInUse(body) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const { item_id, state, type } = body;\n            const transaction = yield models_1.sequelize.transaction();\n            try {\n                if (type === 'shop') {\n                    const shop = this.exec(tables_1.Shop.findOne({\n                        where: {\n                            id: item_id\n                        }\n                    }));\n                    if (shop) {\n                        yield this.exec(tables_1.Shop.update({ not_in_use: state }, {\n                            where: {\n                                id: item_id,\n                            },\n                            transaction\n                        }));\n                        yield this.exec(this.model.update({ not_in_use: state }, {\n                            where: {\n                                shop_id: item_id,\n                            },\n                            transaction\n                        }));\n                        const list_product_shops = yield this.exec(this.model.findAndCount({\n                            where: {\n                                shop_id: item_id,\n                            }\n                        }));\n                        let array_ids = [];\n                        if (list_product_shops.count > 0) {\n                            for (let i = 0; i < list_product_shops.rows.length; i++) {\n                                const item = list_product_shops.rows[i];\n                                array_ids.push(item.product_id);\n                            }\n                        }\n                        if (array_ids.length > 0) {\n                            yield this.exec(tables_1.Product.update({\n                                not_in_use: state\n                            }, {\n                                where: {\n                                    id: { $in: array_ids }\n                                }\n                            }));\n                        }\n                    }\n                }\n                else if (type === 'product') {\n                    const product = this.exec(tables_1.Product.findOne({\n                        where: {\n                            id: item_id\n                        }\n                    }));\n                    if (product) {\n                        yield this.exec(tables_1.Product.update({ not_in_use: state }, {\n                            where: {\n                                id: item_id,\n                            },\n                            transaction\n                        }));\n                        yield this.exec(this.model.update({ not_in_use: state }, {\n                            where: {\n                                product_id: item_id,\n                            },\n                            transaction\n                        }));\n                    }\n                }\n                transaction.commit();\n                return;\n            }\n            catch (error) {\n                transaction.rollback();\n                throw error;\n            }\n        });\n    }\n}\nexports.ProductShopService = ProductShopService;\n//# sourceMappingURL=productShopService.js.map"]}